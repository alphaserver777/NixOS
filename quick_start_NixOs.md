# GitOps
Загружаемся, используя скаченный ISO образ. Нас встречает tty сессия от пользователя nixos. Я рекомендую сразу выполнить команду ниже и изменить пароль на любой удобный вам для работы через ssh:

```
nixos passwd
```

Подключатся по SSH не обязательно, но сильно сэкономит вам время

Также проверьте корректность настройки интернет-соединения. Оно понадобиться в дальнейшем в процессе установки. Это можно сделать, например, с помощью команды ниже:

```
ping ya.ru
```

### Note

Если вы ранее подключались по SSH к виртуальной машине, но затем по какой-то причине её удалили, у вас может возникнуть ошибка подключения. Для её устранения введите в консоль следующее (вместо VM IP введите IP адрес виртуальной машины):

    ```
    ssh-keygen -R {VM IP}
    ```

### Разметка дисков с помощью disko

    Установка системы начинается с разметки диска и каждый делает её по разному. Многие на этом этапе используют императивные утилиты, которые пересекаются с декларативной философией nix. Но сообщество решило и эту проблему с помощью **disko**.

    Disko — созданная сообществом утилита, позволяющая записать схему распределения разделов диска в конфигруационный файл, а затем уже выполнить саму разметку. Такой способ, в купе с configuration.nix, позволяет с лёгкостью воспроизводить установку NixOS на нескольких машинах.

    Итак, для начала посмотрим имеющиеся диски:

    ```
    sudo fdisk -l
    ```
    Результат вывода команды sudo fdisk -l

    Игнорируем /dev/loop0 и видим, что название нашего диска - /dev/vda. Оно может быть и другим, в зависимости от типа и количества дисков. Например, для ssd это может быть nvme0n1, а для HDD - sda, sdb и т.п.

    Теперь перейдём к разметке. На странице disko на [github](https://github.com/nix-community/disko) можно найти стандартный пример конфигурационного файла, которым мы и воспользуемся. Там же имеется множество вариантов этого файла, например с разделом подкачки или btrfs volumes. Создадим файл в каталоге tmp, назовём его disko.nix и внесём туда следующее:

    ```
{
    disko.devices = {
        disk = {
            my-disk = {
                device = "/dev/vda";
                type = "disk";
                content = {
                    type = "gpt";
                    partitions = {
                        ESP = {
                            type = "EF00";
                            size = "500M";
                            content = {
                                type = "filesystem";
                                format = "vfat";
                                mountpoint = "/boot";
                            };
                        };
                        root = {
                            size = "100%";
                            content = {
                                type = "filesystem";
                                format = "ext4";
                                mountpoint = "/";
                            };
                        };
                    };
                };
            };
        };
    };
}
```

В этом случае disko выделит 500 мегабайт для загрузочного раздела, а всё остальное место - под корневой. Я изменил название /dev/sda на /dev/vda. При установки на реальную ЭВМ с HDD этого делать не придётся. Сохраняем изменения и выходим.

Теперь запускаем утилиту с помощью команды ниже, где в конце указываем путь к файлу:

# DANGER ZONE!

```
sudo nix --experimental-features "nix-command flakes" run github:nix-community/disko -- --mode disko disko.nix
```

Дожидаемся завершения работы утилиты и разметка дисков завершена!

Проверить результат можно всё с той же команды для проверки имеющихся дисков:

Результат вывода команды sudo fdisk -l

Как мы можем у видеть, разметка дисков прошла успешно

### Настройка конфигурационного файла

Начнём настройку конфигурационного файла. Сгенерировать его можно следующей командой:

```bash
sudo nixos-generate-config --root /mnt
```

```bash
cp /mnt/etc/nixos/hardware-configuration.nix hardware-configuration.nix

```
Далее необходимо отредактировать файл любым удобным для вас редактором, например nano или vim:

```bash
sudo vim /mnt/etc/nixos/configuration.nix
```

```bash
sudo nixos-install
sudo nixos-install --flake .#HomeLab1
```

В случае возникновения ошибок вернитесь к конфигурационному файлу и проверьте что всё написано в точности как у меня (точки с запятой также важны!).

Дожидаемся конца установки системы, вводим пароль от root пользователя и перезагружаемся с помощью команды `reboot`.

После завершения загрузки выполняем вход под учётной записью root, и изменяем пароль пользователю user:

```bash
sudo nixos-enter
passwd user
```
#SSH

```bash
ssh-keygen -t rsa -b 4096 -C "ваш_email@example.com"

git remote set-url origin git@github.com:username/repository.git

ssh-add ~/<key> # Добавление ключа в кэш, чтобы его не спрашивали в течении сессии
```
-----

### **README: Конфигурация Neovim на NixOS**

#### **Основные плагины и горячие клавиши**

Здесь перечислены наиболее важные плагины и их стандартные сочетания клавиш, используемые в этой конфигурации:

* **NERDTree** — файловый менеджер в Neovim.

* `<C-n>`: Переключить боковую панель NERDTree.

* **vim-fugitive** — интеграция Git.

* `:Gstatus`: Открыть окно статуса Git.
* `:Gblame`: Просмотреть информацию о последнем изменении строки.

* **comment-nvim** — быстрое комментирование кода.

* `gc`: Комментирование/раскомментирование выделенного текста или строки.

* **flash-nvim** — плагин для быстрого перемещения по тексту.

* `<Space>s`: Активировать Flash для быстрого поиска и перехода.

* **Telescope** — мощный инструмент для "нечёткого" поиска файлов, текста и многого другого.

* `<Space>ff`: Найти файлы в проекте.
* `<Space>fg`: Поиск по содержимому файлов (Live Grep).
* `<Space>fb`: Переключиться на другой открытый буфер.
* `<Space>fh`: Поиск по тегам справки Neovim.

-----

#### **Дополнительные настройки**

* **Leader-клавиша**: `<Space>` (пробел) назначена как `leader`-клавиша. Все сочетания с `<leader>` начинаются с неё. Например, `<leader>ff` означает `<Space>ff`.
* **Автоматическое форматирование**:
* `autocmd BufWritePre * Autoformat`: Файл будет автоматически отформатирован с помощью `vim-autoformat` при каждом сохранении.
* **Настройки отступов**:
* `tabstop=2`, `shiftwidth=2`: Ширина отступа — 2 пробела.
* `expandtab`: Заменяет табуляцию на пробелы.
* **Подсветка синтаксиса**:
* Конфигурация включает поддержку подсветки для Lua, Python и Nix.

-----

# **TMUX**

## Управление окнами

Ctrl+P: Переключение на предыдущее окно.

Ctrl+N: Переключение на следующее окно.

Alt+1 по Alt+9: Переключение на окно с соответствующим номером.

Alt+Enter: Создать новое окно.

Alt+Q: Закрыть текущее окно.

- Индикатор NORMAL/COPY в правой части статус-бара.

- Возможность использовать v (начать выделение), V (выделить строку), Ctrl-v (блочное выделение) в режиме копирования (prefix + [).

- Копирование выделенного текста в системный буфер обмена с помощью клавиши y.

## Управление панелями

Alt+S: Разделить текущую панель по горизонтали (вниз).

Alt+V: Разделить текущую панель по вертикали (вправо).

Alt+C: Закрыть текущую панель.

Alt+Left: Переключиться на панель слева.

Alt+Right: Переключиться на панель справа.

Alt+Up: Переключиться на панель сверху.

Alt+Down: Переключиться на панель снизу.

## Изменение размеров панелей

Alt+Shift+Left: Уменьшить ширину текущей панели.

Alt+Shift+Right: Увеличить ширину текущей панели.

Alt+Shift+Up: Увеличить высоту текущей панели.

Alt+Shift+Down: Уменьшить высоту текущей панели.

## Другие команды
Alt+R: Перезагрузить конфигурационный файл tmux.

Alt+O: Открыть новое окно с nvim и списком дел.

Alt+F: Открыть новое окно с nvim и файлом flake.nix.

Alt+N: Открыть новое окно с nvim и конфигурацией Neovim.

Alt+Shift+Q: Закрыть всю сессию tmux.
