# Руководство по использованию dmesg

`dmesg` (от "display message") — это одна из важнейших утилит для диагностики в Linux. Она выводит сообщения из кольцевого буфера ядра, который является своего рода "черным ящиком" операционной системы. В этом буфере фиксируются события, связанные с оборудованием и драйверами, как во время загрузки, так и в процессе работы.

Это руководство поможет вам научиться эффективно использовать `dmesg` для поиска и решения проблем.

## Содержание
- [1. Базовое использование](#1-базовое-использование)
- [2. Отображение времени в человекочитаемом формате](#2-отображение-времени-в-человекочитаемом-формате)
- [3. Фильтрация вывода](#3-фильтрация-вывода)
- [4. Практические сценарии](#4-практические-сценарии)
- [5. Отслеживание событий в реальном времени](#5-отслеживание-событий-в-реальном-времени)
- [6. Шпаргалка](#6-шпаргалка)

---

## 1. Базовое использование

Вывод `dmesg` может быть очень большим. Чтобы просматривать его было удобно, всегда направляйте его в утилиту `less`. Для доступа к буферу ядра часто требуются права суперпользователя (`sudo`).

```bash
sudo dmesg | less
```

Внутри `less` вы можете:
- Использовать стрелки **↑** и **↓** для навигации.
- Нажать **/** для поиска текста.
- Нажать **q** для выхода.

---

## 2. Отображение времени в человекочитаемом формате

По умолчанию `dmesg` показывает время в секундах с момента загрузки системы. Это неудобно для анализа. Ключ `-T` (`--human`) преобразует временные метки в привычный формат даты и времени.

```bash
sudo dmesg -T | less
```

**Сравнение вывода:**
- **Без `-T`:** `[ 12345.678901] usb 1-1: New USB device found...`
- **С `-T`:** `[Сб дек 20 14:30:00 2025] usb 1-1: New USB device found...`

Использование `-T` — это стандартная практика для удобного анализа логов.

---

## 3. Фильтрация вывода

Редко когда нужен весь лог целиком. Обычно ищут что-то конкретное.

### a) Фильтрация с помощью `grep`

Это самый распространенный способ. `grep` ищет строки, содержащие заданный текст. Рекомендуется использовать ключ `-i` для поиска без учета регистра.

**Поиск ошибок и предупреждений:**
```bash
sudo dmesg -T | grep -i "error\|warn\|fail"
```

**Информация о USB-устройствах:**
```bash
sudo dmesg -T | grep -i usb
```

**Информация о дисках (SATA/NVMe):**
```bash
sudo dmesg -T | grep -i "sda\|nvme"
```

### б) Встроенная фильтрация `dmesg` по уровню

`dmesg` умеет фильтровать сообщения по уровню важности с помощью ключа `-l` (`--level`).

**Основные уровни:** `err`, `warn`, `info`, `debug`.

**Пример: показать только ошибки и предупреждения:**
```bash
sudo dmesg -T -l err,warn
```
Этот способ более точен, чем `grep`, так как фильтрует по метаданным сообщения.

---

## 4. Практические сценарии

### Сценарий 1: Подключили USB-устройство, но оно не работает

Сразу после подключения выполните команду `tail`, чтобы увидеть последние 30 строк лога. Именно там будут сообщения о новом устройстве.

```bash
sudo dmesg -T | tail -n 30
```

### Сценарий 2: Подозрение на проблемы с жестким диском

Если система стала нестабильной или появились ошибки ввода-вывода, ищите сообщения, связанные с дисковой подсистемой.

```bash
sudo dmesg -T | grep -i "ata\|sda\|nvme\|error\|fail"
```

---

## 5. Отслеживание событий в реальном времени

Ключ `-w` (`--follow`) позволяет следить за новыми сообщениями ядра в реальном времени, как `tail -f`.

```bash
sudo dmesg -wT
```

Запустите эту команду, затем подключите устройство (например, флешку). Вы сразу увидите в терминале все связанные с этим событием сообщения ядра. Нажмите `Ctrl+C`, чтобы остановить отслеживание.

---

## 6. Шпаргалка

**Посмотреть все сообщения с нормальным временем:**
```bash
sudo dmesg -T | less
```

**Найти конкретные ошибки:**
```bash
sudo dmesg -T | grep -i "error\|fail"
```

**Проверить, что происходит с USB:**
```bash
sudo dmesg -T | grep -i "usb"
```

**Следить за событиями вживую:**
```bash
sudo dmesg -wT
```
